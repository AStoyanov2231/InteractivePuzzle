import{j as e}from"./ui-vendor-D57amxQA.js";import{c as J,u as O,r}from"./react-vendor-oV3x6oea.js";import{B as x,j as R,T as D,R as V,h as X,M as U}from"./game-memory-Boi4oVcu.js";import{R as $,F as q,C as f,b as y,c as w,a as C}from"./RequireNameToggle-nqGoFk1R.js";import{M as Y}from"./game-math-v7lK4ZD4.js";import{W as Z}from"./game-words-DgGK1VmL.js";import{Q as _}from"./game-quiz-CrFe8738.js";import{u as ee}from"./game-speed-Dy4_TRKe.js";const me=()=>{const{categoryId:B}=J(),h=O(),{toast:d}=ee(),[a,G]=r.useState([]),[i,T]=r.useState(0),[M,I]=r.useState(!1),[u,z]=r.useState(0),[W,m]=r.useState(!1),[k,b]=r.useState(""),[j,F]=r.useState("memory"),[se,P]=r.useState({}),K=s=>{const t={id:1,isLocked:!1,timeLimit:300,moves:50};switch(s){case"memory":return{...t,themeId:"memory",difficultyId:"medium",title:"Състезателна игра на паметта",description:"Игра на паметта с категории",grid:"4×4"};case"math":return{...t,themeId:"math",difficultyId:"medium",title:"Математически маратон",description:"Бързи математически изчисления",grid:"4×4"};case"words":return{...t,themeId:"words",difficultyId:"medium",title:"Словесни състезания",description:"Отгатване на разбъркани думи",grid:"4×4"};case"quiz":return{...t,themeId:"mixed",difficultyId:"medium",title:"Блицвикторина",description:"Бързи въпроси от различни области",grid:"4×4"};default:return{...t,themeId:"memory",difficultyId:"medium",title:"Състезателна игра на паметта",description:"Игра на паметта с категории",grid:"4×4"}}};r.useEffect(()=>{const s=localStorage.getItem("puzzleGameTeams");if(s)try{const c=JSON.parse(s).map(p=>({...p,score:0}));G(c);const v={};c.forEach(p=>{v[p.id]=0}),P(v),c.length>0&&c[0].players.length>0&&b(c[0].players[0].id)}catch(o){console.error("Error parsing teams from localStorage",o),h("/")}else h("/");const t=localStorage.getItem("currentGameCategory");t&&F(t)},[B,h]);const g=K(j),l=a[i];a.length;const E=r.useCallback(()=>{m(!0),setTimeout(()=>{if(i<a.length-1){const s=i+1;T(s),z(t=>t+1),a[s]&&a[s].players.length>0&&b(a[s].players[0].id),m(!1)}else I(!0),m(!1),d({title:"Състезанието приключи!",description:"Всички отбори играха своите игри!"})},1500)},[i,a.length,a,d]),n=r.useCallback(()=>{l&&d({title:`${l.name} завърши!`,description:"Игра завършена успешно!"}),setTimeout(()=>{E()},2e3)},[l,d,E]),N=r.useCallback(s=>{b(s)},[]),S=()=>{h("/?category=competitive")},Q=()=>{T(0),I(!1),z(t=>t+1),m(!1);const s={};a.forEach(t=>{s[t.id]=0}),P(s),G(t=>t.map(o=>({...o,score:0}))),a.length>0&&a[0].players.length>0&&b(a[0].players[0].id)},A=r.useCallback(()=>{m(!0);let s=0;const t=()=>{if(s<a.length){const o=a[s];T(s),d({title:`${o.name} завърши!`,description:"Игра завършена успешно!"}),s++,setTimeout(t,800)}else setTimeout(()=>{I(!0),m(!1),d({title:"Състезанието приключи!",description:"Всички отбори играха своите игри!"})},500)};t()},[a,d]),H=()=>{switch(j){case"memory":return e.jsx(U,{level:g,onComplete:n,onTimeUp:n,currentTeam:l,onPlayerTurn:N},u);case"math":return e.jsx(Y,{level:g,onComplete:n,onTimeUp:n,currentTeam:l,onPlayerTurn:N},u);case"words":return e.jsx(Z,{level:g,onComplete:n,onTimeUp:n},u);case"quiz":return e.jsx(_,{level:g,onComplete:n,onTimeUp:n,currentTeam:l,onPlayerTurn:N},u);default:return e.jsx(U,{level:g,onComplete:n,onTimeUp:n,currentTeam:l,onPlayerTurn:N},u)}},L=()=>{switch(j){case"memory":return"Битка на паметта";case"math":return"Математически маратон";case"words":return"Словесни състезания";case"quiz":return"Блицвикторина";default:return"Състезателна игра"}};if(a.length===0)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-400 via-orange-200 to-orange-200 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Зареждане..."}),e.jsx(x,{onClick:()=>h("/"),children:"Назад към началото"})]})});if(M){const s=[...a];return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-400 via-orange-200 to-orange-200 py-6 px-6",children:[e.jsxs("div",{className:"fixed top-4 right-4 z-50 flex items-center gap-2",children:[e.jsx($,{}),e.jsx(q,{})]}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(x,{onClick:S,variant:"outline",className:"flex items-center gap-2 rounded-2xl shadow-lg bg-white/60 hover:bg-white/80 backdrop-blur-sm border border-white/30",children:[e.jsx(R,{size:18}),"Назад"]})}),e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs(f,{className:"bg-gradient-to-br from-yellow-400 to-orange-500 border-0 shadow-2xl",children:[e.jsx(y,{className:"pb-3",children:e.jsxs(w,{className:"text-3xl text-white flex items-center justify-center gap-3",children:[e.jsx(D,{className:"w-8 h-8"}),"Състезанието приключи!"]})}),e.jsx(C,{className:"text-white",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold mb-2",children:["Играна игра: ",L()]}),e.jsx("p",{className:"text-2xl font-bold",children:"🎉 Всички отбори завършиха успешно!"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-3",children:"Участници:"}),e.jsx("div",{className:"grid gap-3",children:s.map((t,o)=>{const c=o+1,v=c===1?"🥇":c===2?"🥈":c===3?"🥉":"🏆";return e.jsxs("div",{className:"flex items-center justify-between rounded-lg p-4 bg-white/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg bg-white/30 text-white",children:v}),e.jsxs("div",{className:"text-left",children:[e.jsx("span",{className:"font-bold text-lg",children:t.name}),e.jsx("div",{className:"text-sm opacity-90",children:t.players.map(p=>p.name).join(", ")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold",children:"✅"}),e.jsx("div",{className:"text-sm opacity-90",children:"завършено"})]})]},t.id)})})]})]})})]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsxs(x,{onClick:Q,size:"lg",className:"gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Ново състезание"]}),e.jsx(x,{onClick:S,variant:"outline",size:"lg",children:"Назад към игрите"})]})]})]})]})}return l?l.players.find(s=>s.id===k):null,e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-orange-400 via-orange-200 to-orange-200 flex",children:[e.jsxs("div",{className:"fixed top-4 right-4 z-50 flex items-center gap-2",children:[e.jsx($,{}),e.jsx(q,{})]}),e.jsx("div",{className:"w-80 bg-gradient-to-br from-orange-400 via-orange-200 to-orange-200 shadow-2xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs(x,{onClick:S,variant:"outline",size:"sm",className:"flex items-center gap-2 mb-4 bg-white/80 hover:bg-white border-orange-300",children:[e.jsx(R,{size:18}),"Назад"]}),e.jsx(x,{onClick:A,variant:"destructive",size:"sm",className:"flex items-center gap-2 mb-6 bg-red-500/80 hover:bg-red-600 text-white border-0",children:"🚀 Завърши състезанието"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(f,{className:"bg-white/90 backdrop-blur-sm border-0 shadow-lg",children:[e.jsx(y,{className:"pb-3",children:e.jsxs(w,{className:"text-lg text-center text-gray-800 flex items-center justify-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),L()]})}),e.jsxs(C,{children:[e.jsxs("div",{className:"text-center text-sm text-gray-600 mb-4",children:["Отбор ",i+1," от ",a.length]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-4",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${i/a.length*100}%`}})})]})]}),l&&e.jsxs(f,{className:"bg-white/90 backdrop-blur-sm border-0 shadow-lg",children:[e.jsx(y,{className:"pb-3",children:e.jsx(w,{className:"text-lg text-gray-800",children:"Текущ отбор"})}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"font-medium text-blue-600",children:l.name}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Играчи:"}),l.players.map((s,t)=>e.jsxs("div",{className:`text-sm rounded px-2 py-1 transition-all duration-300 ${s.id===k?"bg-blue-500 text-white font-medium":"bg-gray-100 text-gray-700"}`,children:[s.name,s.id===k&&j==="memory"&&" (играе сега)"]},t))]})]})})]}),e.jsxs(f,{className:"bg-white/90 backdrop-blur-sm border-0 shadow-lg",children:[e.jsx(y,{className:"pb-3",children:e.jsx(w,{className:"text-lg text-gray-800",children:"Всички отбори"})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:a.map((s,t)=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded-lg ${t===i?"bg-blue-100 border-2 border-blue-300":t<i?"bg-green-100 border border-green-300":"bg-gray-100 border border-gray-300"}`,children:[e.jsx("span",{className:"font-medium text-sm",children:s.name}),e.jsx("span",{className:"text-xs",children:t<i?"✓":t===i?"▶":"○"})]},s.id))})})]})]})]})}),e.jsx("div",{className:"flex-1 p-6",children:e.jsx("div",{className:"h-full",children:W?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(f,{className:"bg-white/90 backdrop-blur-sm border-0 shadow-xl p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-800 mb-4",children:i>=a.length?"Състезанието приключи!":"Следващ отбор..."}),e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"})]})})}):e.jsx("div",{className:"bg-white/40 backdrop-blur-sm rounded-3xl shadow-xl border border-white/30 p-6 h-full",children:e.jsx("div",{className:"h-full flex flex-col",children:e.jsx("div",{className:"flex-1 bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-4 overflow-auto",children:H()})})})})})]})};export{me as default};
