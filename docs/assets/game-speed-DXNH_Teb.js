import{j as e}from"./ui-vendor-D57amxQA.js";import{r as s,u as Z}from"./react-vendor-oV3x6oea.js";import{T as ee,B as I,H as se,g as V,c as K,b as te}from"./game-memory-DPb6ehu5.js";const le=1,ae=1e6;let P=0;function re(){return P=(P+1)%Number.MAX_SAFE_INTEGER,P.toString()}const G=new Map,Q=t=>{if(G.has(t))return;const l=setTimeout(()=>{G.delete(t),T({type:"REMOVE_TOAST",toastId:t})},ae);G.set(t,l)},ne=(t,l)=>{switch(l.type){case"ADD_TOAST":return{...t,toasts:[l.toast,...t.toasts].slice(0,le)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===l.toast.id?{...a,...l.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=l;return a?Q(a):t.toasts.forEach(r=>{Q(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return l.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==l.toastId)}}},O=[];let R={toasts:[]};function T(t){R=ne(R,t),O.forEach(l=>{l(R)})}function ce({...t}){const l=re(),a=d=>T({type:"UPDATE_TOAST",toast:{...d,id:l}}),r=()=>T({type:"DISMISS_TOAST",toastId:l});return T({type:"ADD_TOAST",toast:{...t,id:l,open:!0,onOpenChange:d=>{d||r()}}}),{id:l,dismiss:r,update:a}}function ie(){const[t,l]=s.useState(R);return s.useEffect(()=>(O.push(l),()=>{const a=O.indexOf(l);a>-1&&O.splice(a,1)}),[t]),{...t,toast:ce,dismiss:a=>T({type:"DISMISS_TOAST",toastId:a})}}const _=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),W=768;function Y(){const[t,l]=s.useState(void 0);return s.useEffect(()=>{const a=window.matchMedia(`(max-width: ${W-1}px)`),r=()=>{l(window.innerWidth<W)};return a.addEventListener("change",r),l(window.innerWidth<W),()=>a.removeEventListener("change",r)},[]),!!t}const X=({speed:t,onCorrect:l,onIncorrect:a,gameActive:r,difficulty:d})=>{const[o,v]=s.useState("green"),[N,b]=s.useState(["green","blue"]),n=s.useRef(null),u=Y(),m={green:"#22c55e",blue:"#3b82f6",red:"#ef4444"},y={green:"Зелено",blue:"Синьо",red:"Червено"},w=()=>d==="hard"?["green","blue","red"]:["green","blue"],f=s.useCallback(()=>{const i=w(),j=i[Math.floor(Math.random()*i.length)],x=[...i].sort(()=>Math.random()-.5);v(j),b(x)},[d]),h=s.useCallback(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r&&(f(),h())},t)},[t,r,f]);s.useEffect(()=>(r?(f(),h()):n.current&&(clearTimeout(n.current),n.current=null),()=>{n.current&&(clearTimeout(n.current),n.current=null)}),[r,t,f,h]);const C=s.useCallback(i=>{r&&(n.current&&(clearTimeout(n.current),n.current=null),i===o?l():a(),f(),h())},[r,o,l,a,f,h]),S=d==="hard"?"grid-cols-3":"grid-cols-2";return e.jsxs("div",{className:`flex flex-col items-center w-full ${u?"max-w-sm":"max-w-2xl"}`,children:[e.jsx("div",{className:`w-full bg-white rounded-2xl shadow-lg flex items-center justify-center ${u?"p-4 mb-4":"p-8 mb-8"}`,children:e.jsx("div",{className:`rounded-2xl flex items-center justify-center text-white font-bold transition-all ${u?"w-32 h-32 text-lg":"w-40 h-40 text-2xl"}`,style:{backgroundColor:m[o],boxShadow:`0 10px 15px -3px ${m[o]}40`},children:y[o]})}),e.jsx("div",{className:`grid ${S} w-full ${u?"gap-4":"gap-8"}`,children:N.map((i,j)=>e.jsx("button",{onClick:()=>C(i),className:`aspect-square rounded-3xl shadow-lg transform transition-all hover:scale-105 active:scale-95 focus:outline-none ${u?"touch-manipulation":""}`,style:{backgroundColor:m[i],boxShadow:`0 10px 15px -3px ${m[i]}40`},disabled:!r},j))})]})},oe=({correctAnswers:t,wrongAnswers:l,totalAttempts:a,timeSpent:r,onPlayAgain:d})=>{const o=Z(),v=b=>{const n=Math.floor(b/60),u=b%60;return`${n}:${u.toString().padStart(2,"0")}`},N=localStorage.getItem("currentPlayerName")||"Играч";return e.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(ee,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:["Браво, ",N,"!"]}),e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Завърши скоростната игра!"}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Време:"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:v(r)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Общо опити:"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:a})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600",children:"Верни:"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:t})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-red-600",children:"Грешни:"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:l})]})]})]})]}),e.jsxs(I,{onClick:()=>{_()?d():o("/")},variant:"outline",className:"w-full",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),_()?"Играй отново":"Към началото"]})]})})},de=({label:t="",seconds:l,hasStarted:a})=>{const r=Math.floor(l/60).toString().padStart(2,"0"),d=(l%60).toString().padStart(2,"0");return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-2",children:t}),e.jsxs("div",{className:"relative mx-auto w-36 h-36",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-12 h-6 bg-gray-300 rounded-t-xl shadow"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-4 border-slate-300 shadow-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold tabular-nums tracking-wider",children:a?`${r}:${d}`:"00:00"})}),e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-3 w-3 h-1 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-3 w-3 h-1 bg-slate-400 rounded"})]})]})},he=({level:t,onComplete:l,onTimeUp:a,onBackToSelection:r,onGameStateChange:d})=>{const[o,v]=s.useState(null),[N,b]=s.useState(!1),[n,u]=s.useState(!1),[m,y]=s.useState(0),[w,f]=s.useState(0),[h,C]=s.useState(0),[E,S]=s.useState(0),i=s.useRef(null),{toast:j}=ie(),x=Y(),L=_(),[A,z]=s.useState(60),[D,J]=s.useState(1),g=s.useRef(null),p=s.useRef(null),q=Math.round(D*1e3),F=s.useCallback(()=>{b(!0),y(0),f(0),C(0),S(0),i.current&&clearInterval(i.current),p.current=Date.now(),i.current=setInterval(()=>{if(p.current!==null){const c=Math.floor((Date.now()-p.current)/1e3);y(c)}},200),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{var c;typeof a=="function"&&a(),(c=k.current)==null||c.call(k)},A*1e3)},[A,a]),M=s.useCallback(async()=>{if(i.current&&clearInterval(i.current),g.current&&(clearTimeout(g.current),g.current=null),p.current!==null){const c=Math.floor((Date.now()-p.current)/1e3);y(c)}if(p.current=null,u(!0),V.isSinglePlayerMode()&&!_())try{await V.submitSpeedGameStats({correctAnswers:w,wrongAnswers:h,timeElapsed:m}),console.log("Stats submitted via Complete Game button")}catch(c){console.error("Failed to submit stats:",c)}l()},[l,w,h,m]),k=s.useRef(M);s.useEffect(()=>{k.current=M},[M]);const H=s.useCallback(()=>{f(c=>c+1),S(c=>c+1),j({title:"Правилен отговор!",description:"Браво!",duration:1e3})},[j]),B=s.useCallback(()=>{C(c=>c+1),S(c=>c+1),j({title:"Грешен отговор!",description:"Опитай отново!",variant:"destructive",duration:1e3})},[j]),U=s.useCallback(()=>{u(!1),b(!1)},[]),$=s.useCallback(()=>{if(i.current&&clearInterval(i.current),g.current&&clearTimeout(g.current),p.current=null,L&&r){r();return}v(null),b(!1),u(!1),y(0),f(0),C(0),S(0)},[L,r]);return s.useCallback(()=>{$()},[$]),s.useEffect(()=>()=>{i.current&&clearInterval(i.current),g.current&&clearTimeout(g.current),p.current=null},[]),s.useEffect(()=>{o&&!N&&!n&&F()},[o,N,n,F]),s.useEffect(()=>{d&&d(!o)},[o,d]),n?e.jsx(oe,{correctAnswers:w,wrongAnswers:h,totalAttempts:E,timeSpent:m,onPlayAgain:U}):o?x?e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-green-600",children:w}),e.jsx("div",{className:"text-xs text-gray-500",children:"Верни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-red-600",children:h}),e.jsx("div",{className:"text-xs text-gray-500",children:"Грешни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:E}),e.jsx("div",{className:"text-xs text-gray-500",children:"Общо"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-lg",children:[Math.floor(m/60).toString().padStart(2,"0"),":",(m%60).toString().padStart(2,"0")]}),e.jsx("div",{className:"text-xs text-gray-500",children:o==="slow"?"Бавно":"Бързо"})]})]})}),e.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-md p-4",children:e.jsx("div",{className:"flex justify-center h-full",children:e.jsx(X,{speed:q,onCorrect:H,onIncorrect:B,gameActive:!n,difficulty:o==="slow"?"easy":"hard"})})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mt-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(I,{variant:"outline",onClick:$,className:"flex-1",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Отначало"]}),e.jsxs(I,{variant:"outline",onClick:M,className:"flex-1 bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Завърши"]})]})})]}):e.jsxs("div",{className:"flex w-full gap-4 items-start -mx-4",children:[e.jsx("aside",{className:"w-[220px] shrink-0 pl-4",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4",children:e.jsx(de,{seconds:m,hasStarted:N})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-4",children:e.jsxs("div",{className:"space-y-4 text-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Верни"}),e.jsx("span",{className:"font-semibold",children:w})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Грешни"}),e.jsx("span",{className:"font-semibold",children:h})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Общо"}),e.jsx("span",{className:"font-semibold",children:E})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Скорост"}),e.jsx("span",{className:"font-semibold",children:o==="slow"?"Бавно":"Бързо"})]})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-3 space-y-2",children:e.jsxs(I,{variant:"outline",onClick:$,className:"w-full",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Започни отначало"]})})]})}),e.jsx("div",{className:"flex-1 flex flex-col items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 w-full",children:[e.jsx("div",{className:"text-center mb-6"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(X,{speed:q,onCorrect:H,onIncorrect:B,gameActive:!n,difficulty:o==="slow"?"easy":"hard"})})]})})]}):e.jsx("div",{className:`flex flex-col items-center justify-center w-full ${x?"py-4 px-4":"max-w-4xl mx-auto py-12"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl text-center w-full ${x?"p-4":"p-8 max-w-2xl"}`,children:[e.jsx("h2",{className:`font-bold text-gray-800 mb-6 ${x?"text-xl":"text-3xl"}`,children:"Изберете скорост"}),e.jsxs("div",{className:`grid gap-6 ${x?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>v("slow"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${x?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${x?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#10B98120"},children:"🐌"}),e.jsx("span",{className:`font-semibold text-gray-800 ${x?"text-lg":"text-xl"}`,children:"Бавно"})]}),e.jsxs("button",{onClick:()=>v("fast"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${x?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${x?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#EF444420"},children:"🚀"}),e.jsx("span",{className:`font-semibold text-gray-800 ${x?"text-lg":"text-xl"}`,children:"Бързо"})]})]}),e.jsxs("div",{className:"mt-8 space-y-6 text-left",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Продължителност: ",e.jsxs("span",{className:"font-semibold",children:[A," сек"]})]}),e.jsx("input",{type:"range",min:30,max:90,step:5,value:A,onChange:c=>z(Number(c.target.value)),className:"w-full accent-green-600"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"30s"}),e.jsx("span",{children:"90s"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Скорост на смяна: ",e.jsxs("span",{className:"font-semibold",children:[D.toFixed(1)," сек"]})]}),e.jsx("input",{type:"range",min:.5,max:1.5,step:.1,value:D,onChange:c=>J(Number(c.target.value)),className:"w-full accent-green-600"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"0.5s"}),e.jsx("span",{children:"1.5s"})]})]})]})]})})};export{he as S,_ as i,ie as u};
