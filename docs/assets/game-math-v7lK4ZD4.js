import{j as e}from"./ui-vendor-D57amxQA.js";import{u as $e,r as D}from"./react-vendor-oV3x6oea.js";import{u as Ee,b as Pe,T as Ae,B as se,H as De,C as le,c as Te,g as fe,X as Me}from"./game-memory-Boi4oVcu.js";const K=o=>{switch(o){case"×":return"*";case"÷":return"/";default:return o}},pe=(o,b,l,c,d)=>{if(c===void 0||d===void 0)switch(K(b)){case"+":return o+l;case"-":return o-l;case"*":return o*l;case"/":return o/l;default:return 0}const y=K(b),u=K(c);if((u==="*"||u==="/")&&(y==="+"||y==="-")){let j;switch(u){case"*":j=l*d;break;case"/":j=l/d;break;default:j=l}switch(y){case"+":return o+j;case"-":return o-j;default:return 0}}else{let j;switch(y){case"+":j=o+l;break;case"-":j=o-l;break;case"*":j=o*l;break;case"/":j=o/l;break;default:j=o}switch(u){case"+":return j+d;case"-":return j-d;case"*":return j*d;case"/":return j/d;default:return j}}},ze=(o,b,l,c,d,y,u)=>{const j=[K(b),K(c),K(y)];let E=[...[o,l,d,u]],P=[...j];for(let g=0;g<P.length;g++)if(P[g]==="*"||P[g]==="/"){let k;P[g]==="*"?k=E[g]*E[g+1]:k=E[g]/E[g+1],E.splice(g,2,k),P.splice(g,1),g--}for(let g=0;g<P.length;g++){let k;P[g]==="+"?k=E[g]+E[g+1]:k=E[g]-E[g+1],E.splice(g,2,k),P.splice(g,1),g--}return E[0]},Re=o=>{const b={addition:"+",subtraction:"-",multiplication:"×",division:"÷"},l=o.map(c=>b[c]).filter(Boolean);return l.length>0?l:["+"]},Ue=o=>{const b=[];for(let l=1;l<=9;l++)for(let c=1;c<=9;c++){let d=0;switch(o){case"+":d=l+c;break;case"-":d=l-c;break;case"×":d=l*c;break;case"÷":c!==0&&l%c===0?d=l/c:d=-1;break;default:d=l+c}d>=0&&d<=9&&Number.isInteger(d)&&(o!=="÷"||c>=2&&d>=1)&&b.push({A:l,B:c,R:d})}return b},Ve=(o,b)=>{const l=b.op?[b.op]:o.slice().sort(()=>Math.random()-.5);for(const c of l){const d=Ue(c).filter(y=>(b.A===void 0||y.A===b.A)&&(b.B===void 0||y.B===b.B)&&(b.R===void 0||y.R===b.R));if(d.length>0)return{...d[Math.floor(Math.random()*d.length)],op:c}}return null},xe=[{size:5,lines:[{r:0,c:0,dir:"h"},{r:2,c:0,dir:"h"},{r:4,c:0,dir:"h"},{r:0,c:0,dir:"v"}]},{size:5,lines:[{r:0,c:0,dir:"h"},{r:0,c:2,dir:"v"},{r:2,c:0,dir:"h"}]},{size:5,lines:[{r:0,c:0,dir:"h"},{r:0,c:0,dir:"v"},{r:4,c:0,dir:"h"}]},{size:5,lines:[{r:0,c:0,dir:"h"},{r:4,c:0,dir:"h"},{r:0,c:4,dir:"v"}]},{size:5,lines:[{r:1,c:0,dir:"h"},{r:3,c:0,dir:"h"},{r:0,c:2,dir:"v"}]}],be=o=>{const b=[];for(let l=0;l<5;l++){const c=o.dir==="h"?o.r:o.r+l,d=o.dir==="h"?o.c+l:o.c,y=l===1?"operator":l===3?"equals":"number";b.push({r:c,c:d,kind:y,idx:l})}return b},ve=(o,b="medium")=>{const l=Re(o),c=xe[Math.floor(Math.random()*xe.length)],d=c.size,y=Array.from({length:d},(n,m)=>Array.from({length:d},(f,I)=>({id:`cell_${m}_${I}`,row:m,col:I,kind:"empty"}))),u={},j=(n,m,f,I)=>{y[n][m]={id:`cell_${n}_${m}`,row:n,col:m,kind:"fixed",type:I,value:f},u[`${n},${m}`]={type:I,value:f}},$=(n,m,f,I)=>{y[n][m]={id:`cell_${n}_${m}`,row:n,col:m,kind:"blank",type:I,correctValue:f},u[`${n},${m}`]={type:I,value:f}},E=()=>{for(let n=0;n<d;n++)for(let m=0;m<d;m++)y[n][m]={id:`cell_${n}_${m}`,row:n,col:m,kind:"empty"};for(const n in u)delete u[n];for(const n of c.lines){const m=be(n),f={},I=m[1],T=u[`${I.r},${I.c}`];T&&T.type==="operator"&&(f.op=T.value);const A=m[0],U=u[`${A.r},${A.c}`];U&&U.type==="number"&&(f.A=parseInt(U.value));const N=m[2],B=u[`${N.r},${N.c}`];B&&B.type==="number"&&(f.B=parseInt(B.value));const ne=m[4],O=u[`${ne.r},${ne.c}`];O&&O.type==="number"&&(f.R=parseInt(O.value));const V=Ve(l,f);if(!V)return!1;const G=[{type:"number",value:String(V.A)},{type:"operator",value:V.op},{type:"number",value:String(V.B)},{type:"equals",value:"="},{type:"number",value:String(V.R)}];for(let H=0;H<5;H++){const{r:L,c:F,kind:ae}=m[H],q=G[H],X=u[`${L},${F}`];if(X){if(X.type!==q.type||X.value!==q.value)return!1;continue}ae==="equals"?j(L,F,q.value,"equals"):$(L,F,q.value,q.type)}}return!0};let P=0;for(;P<50&&!E();)P++;for(const n of c.lines){const m=be(n),I=[0,2,4].filter(T=>{const A=y[m[T].r][m[T].c];return A.kind==="blank"&&A.correctValue&&m[T].kind==="number"});if(I.length>0){const T=I[Math.floor(Math.random()*I.length)],A=m[T],U=y[A.r][A.c];y[A.r][A.c]={id:U.id,row:A.r,col:A.c,kind:"fixed",type:"number",value:U.correctValue}}}const g=[],k=new Map;for(let n=0;n<d;n++)for(let m=0;m<d;m++){const f=y[n][m];if(f.kind==="blank"&&f.correctValue&&f.type){g.push({id:f.id,position:0,correctValue:f.correctValue,type:f.type});const I=k.get(f.correctValue)||0;k.set(f.correctValue,I+1)}}const M=[];k.forEach((n,m)=>{for(let f=0;f<n;f++)M.push(m)});const _=new Set,re=n=>{[n-1,n+1,n-2,n+2].forEach(f=>{f>=1&&f<=9&&_.add(String(f))})};return g.forEach(n=>{n.type==="number"&&re(parseInt(n.correctValue))}),_.forEach(n=>{k.has(n)||M.push(n)}),l.forEach(n=>M.push(n)),M.sort(()=>Math.random()-.5),{mode:"grid",grid:y,blanks:g,options:M,correctAnswer:0}},_e=({label:o="",seconds:b,hasStarted:l})=>{const c=Math.floor(b/60).toString().padStart(2,"0"),d=(b%60).toString().padStart(2,"0");return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-2",children:o}),e.jsxs("div",{className:"relative mx-auto w-36 h-36",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-12 h-6 bg-gray-300 rounded-t-xl shadow"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-4 border-slate-300 shadow-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold tabular-nums tracking-wider",children:l?`${c}:${d}`:"00:00"})}),e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-3 w-3 h-1 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-3 w-3 h-1 bg-slate-400 rounded"})]})]})},Le=({level:o,onComplete:b,onTimeUp:l,currentTeam:c,onPlayerTurn:d})=>{var he;const y=$e(),[u,j]=D.useState([]),[$,E]=D.useState(0),[P,g]=D.useState([]),[k,M]=D.useState({}),[_,re]=D.useState(0),[z,n]=D.useState(null),[m,f]=D.useState(null),[I,T]=D.useState(!1),[A,U]=D.useState(0),[N,B]=D.useState({isDragging:!1,draggedItemId:null,startPosition:null,currentPosition:null,draggedElement:null}),ne=D.useRef(null),O=D.useRef({}),{timeLeft:V,hasStarted:G,showTimeUpScreen:H,startTimer:L,stopTimer:F,resetTimer:ae}=Ee({enabled:!0});D.useEffect(()=>{const t=o.themeId.split(",").map(r=>r.trim()),i=Array.from({length:8},()=>ve(t,o.difficultyId));j(i)},[o.themeId,o.difficultyId]),D.useEffect(()=>{if(u.length>0&&$<u.length){const s=u[$].options.map((i,r)=>({id:`option_${r}`,value:i,isUsed:!1}));g(s),M({}),n(null)}},[u,$]),D.useEffect(()=>{u.length>0&&$>=u.length&&!I&&(console.log("Game completed! Current index:",$,"Problems length:",u.length),F(),c?b():T(!0))},[$,u.length,I,c,b,F]);const q=(t,s)=>{f(s),t.dataTransfer.setData("text/plain",s),G||L()},X=t=>{t.preventDefault()},oe=(t,s)=>{t.preventDefault();const i=t.dataTransfer.getData("text/plain"),r=P.find(a=>a.id===i);if(r&&!r.isUsed){const a=k[s];a&&g(x=>x.map(p=>p.value===a?{...p,isUsed:!1}:p)),M(x=>({...x,[s]:r.value})),g(x=>x.map(p=>p.id===i?{...p,isUsed:!0}:p))}f(null)},ie=(t,s)=>{t.preventDefault();const i=t.touches[0],r=t.currentTarget;B({isDragging:!0,draggedItemId:s,startPosition:{x:i.clientX,y:i.clientY},currentPosition:{x:i.clientX,y:i.clientY},draggedElement:r}),f(s),G||L(),r.style.transform="scale(1.1)",r.style.zIndex="1000",r.style.pointerEvents="none"},ce=t=>{if(t.preventDefault(),!N.isDragging||!N.draggedElement)return;const s=t.touches[0],i={x:s.clientX,y:s.clientY};if(B(a=>({...a,currentPosition:i})),N.startPosition){const a=i.x-N.startPosition.x,x=i.y-N.startPosition.y;N.draggedElement.style.transform=`translate(${a}px, ${x}px) scale(1.1)`}const r=document.elementFromPoint(s.clientX,s.clientY);if(Object.values(O.current).forEach(a=>{a&&a.classList.remove("touch-hover","touch-hover-operator")}),r){const a=r.closest("[data-drop-zone]");a&&(a.getAttribute("data-blank-type")==="operator"?a.classList.add("touch-hover-operator"):a.classList.add("touch-hover"))}},de=t=>{if(t.preventDefault(),!N.isDragging||!N.currentPosition||!N.draggedElement){ue();return}const s=document.elementFromPoint(N.currentPosition.x,N.currentPosition.y),i=s==null?void 0:s.closest("[data-drop-zone]");if(i&&N.draggedItemId){const r=i.getAttribute("data-drop-zone"),a=P.find(x=>x.id===N.draggedItemId);if(a&&!a.isUsed&&r){const x=k[r];x&&g(p=>p.map(w=>w.value===x?{...w,isUsed:!1}:w)),M(p=>({...p,[r]:a.value})),g(p=>p.map(w=>w.id===N.draggedItemId?{...w,isUsed:!0}:w)),i.classList.add("drop-success"),setTimeout(()=>{i.classList.remove("drop-success")},300)}}ue()},ue=()=>{N.draggedElement&&(N.draggedElement.style.transform="",N.draggedElement.style.zIndex="",N.draggedElement.style.pointerEvents=""),Object.values(O.current).forEach(t=>{t&&t.classList.remove("touch-hover","touch-hover-operator","drop-success")}),B({isDragging:!1,draggedItemId:null,startPosition:null,currentPosition:null,draggedElement:null}),f(null)},me=t=>{const s=k[t];s&&(g(i=>i.map(r=>r.value===s?{...r,isUsed:!1}:r)),M(i=>{const r={...i};return delete r[t],r}))},ye=()=>{var r;if(u.length===0||$>=u.length)return;const t=u[$];let s=!0;const i=a=>a==="×"?"*":a==="÷"?"/":a;if(t.mode==="grid"&&t.grid){const a=t.grid.length,x=((r=t.grid[0])==null?void 0:r.length)||0,p=(v,h)=>{const C=t.grid[v][h];if(C.kind==="fixed")return{type:C.type||"number",value:C.value||""};if(C.kind==="blank"){const S=k[C.id];return S?{type:C.type||"number",value:S}:null}return null},w=v=>{const h=v.map(({r:te,c:Ce})=>p(te,Ce));if(h.some(te=>te===null))return!1;const[C,S,Y,Z,J]=h;if(Z.type!=="equals")return!1;const Q=parseInt(C.value,10),W=parseInt(Y.value,10),ee=parseInt(J.value,10),Se=i(S.value);if([Q,W,ee].some(te=>Number.isNaN(te)))return!1;switch(Se){case"+":return Q+W===ee;case"-":return Q-W===ee;case"*":return Q*W===ee;case"/":return W!==0&&Q/W===ee;default:return!1}};e:for(let v=0;v<a;v++)for(let h=0;h<x;h++){const C=t.grid[v][h];if(C.kind==="fixed"&&C.type==="equals"){if(h-3>=0&&h+1<x){const S=[{r:v,c:h-3},{r:v,c:h-2},{r:v,c:h-1},{r:v,c:h},{r:v,c:h+1}];if(S.every(({r:Z,c:J})=>t.grid[Z][J].kind!=="empty")&&!w(S)){s=!1;break e}}if(v-3>=0&&v+1<a){const S=[{r:v-3,c:h},{r:v-2,c:h},{r:v-1,c:h},{r:v,c:h},{r:v+1,c:h}];if(S.every(({r:Z,c:J})=>t.grid[Z][J].kind!=="empty")&&!w(S)){s=!1;break e}}}}}else{const x=(t.equation||"").trim().split(/\s+/).map(w=>{const v=w.match(/^BLANK_(\d+)$/);if(v){const h=`blank_${v[1]}`;return k[h]||""}return w}),p=x.indexOf("=");if(p===-1)s=!1;else{const w=x.slice(0,p),v=parseInt(x[p+1],10),h=[],C=[];for(let S=0;S<w.length;S++)if(S%2===0){const Y=parseInt(w[S],10);if(Number.isNaN(Y)){s=!1;break}h.push(Y)}else C.push(w[S]);if(s){let S=0;h.length===2?S=pe(h[0],C[0],h[1]):h.length===3?S=pe(h[0],C[0],h[1],C[1],h[2]):h.length===4?S=ze(h[0],C[0],h[1],C[1],h[2],C[2],h[3]):s=!1,s&&(s=S===v)}}}n(s?"correct":"incorrect"),s&&re(a=>a+1),setTimeout(()=>{if(E(a=>a+1),c&&d&&s){const a=(A+1)%c.players.length;U(a),d(c.players[a].id)}},1500)},je=(t,s)=>{let i=t.split(/BLANK_\d+/),r=[];return i.forEach((a,x)=>{if(r.push(e.jsx("span",{children:a},`part_${x}`)),x<s.length){const p=s[x],w=k[p.id];r.push(e.jsx("div",{ref:v=>{O.current[p.id]=v},"data-drop-zone":p.id,"data-blank-type":p.type,className:`relative inline-flex items-center justify-center w-16 h-12 mx-1 border-2 border-dashed rounded-md transition-all touch-drop-zone align-middle ${w?z==="correct"?"bg-green-100 border-green-400":z==="incorrect"?"bg-red-100 border-red-400":p.type==="operator"?"bg-orange-100 border-orange-400 cursor-pointer":"bg-blue-100 border-blue-400 cursor-pointer":p.type==="operator"?"border-orange-400 bg-orange-50":"border-gray-400 bg-gray-50"}`,onDragOver:X,onDrop:v=>oe(v,p.id),onClick:()=>w&&z===null&&me(p.id),style:{minHeight:"3rem",minWidth:"4rem",verticalAlign:"middle",display:"inline-flex"},children:w&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-2xl font-semibold leading-none",children:w}),z===null&&e.jsx("div",{className:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold opacity-70 hover:opacity-100 transition-opacity cursor-pointer",children:"×"})]})},p.id))}}),r},Ne=(t,s)=>{var i;return e.jsx("div",{className:"inline-block",children:e.jsx("div",{className:"grid gap-1",style:{gridTemplateColumns:`repeat(${((i=t[0])==null?void 0:i.length)||0}, 3rem)`},children:t.flat().map(r=>{if(r.kind==="empty")return e.jsx("div",{className:"w-12 h-12"},r.id);if(r.kind==="fixed")return e.jsx("div",{className:`w-12 h-12 rounded-md border flex items-center justify-center text-xl font-semibold ${r.type==="equals"?"bg-slate-100 border-slate-300":"bg-gray-100 border-gray-300"}`,children:r.value},r.id);const a=k[r.id],x=r.type==="operator";return e.jsx("div",{ref:p=>{O.current[r.id]=p},"data-drop-zone":r.id,"data-blank-type":r.type,onDragOver:X,onDrop:p=>oe(p,r.id),onClick:()=>a&&z===null&&me(r.id),className:`w-12 h-12 rounded-md border-2 border-dashed flex items-center justify-center transition-all touch-drop-zone ${a?z==="correct"?"bg-green-100 border-green-400":z==="incorrect"?"bg-red-100 border-red-400":x?"bg-orange-100 border-orange-400 cursor-pointer":"bg-blue-100 border-blue-400 cursor-pointer":x?"border-orange-400 bg-orange-50":"border-gray-400 bg-gray-50"}`,children:a&&e.jsx("span",{className:"text-2xl font-semibold leading-none",children:a})},r.id)})})})},we=t=>{const s=Math.floor(t/60),i=t%60;return`${s}:${i.toString().padStart(2,"0")}`},ge=()=>{E(0),g([]),M({}),n(null),T(!1),U(0),ae(),re(0);const t=o.themeId.split(",").map(r=>r.trim()),i=Array.from({length:8},()=>ve(t,o.difficultyId));j(i)},ke=()=>{if(u.length===0||$>=u.length)return;const t=u[$],s={};t.blanks.forEach(i=>{s[i.id]=i.correctValue}),g(i=>i.map(r=>{const a=t.blanks.some(x=>x.correctValue===r.value);return{...r,isUsed:a}})),M(s),G||L()};if(u.length===0)return e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("h2",{className:"text-xl font-medium",children:"Зареждане на играта..."})});if(H)return e.jsx(Pe,{onReset:ge});if(I){const t=u.length-_,s=localStorage.getItem("currentPlayerName")||"Играч";return e.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(Ae,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:["Браво, ",s,"!"]}),e.jsxs("p",{className:"text-lg text-gray-700 mb-4",children:["Завърши всички ",u.length," задачи!"]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Време:"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:we(V)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Резултат:"}),e.jsxs("div",{className:"text-xl font-bold text-green-600",children:[_,"/",u.length]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600",children:"Верни:"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:_})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-red-600",children:"Грешни:"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:t})]})]})]})]}),e.jsxs(se,{onClick:()=>y("/"),variant:"outline",className:"w-full",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Към началото"]})]})})}const R=u[$];if(!R)return console.log("No current problem found, index:",$,"problems length:",u.length),e.jsx("div",{className:"flex flex-col items-center justify-center py-12",children:e.jsx("h2",{className:"text-xl font-medium",children:"Зареждане резултата..."})});const Ie=R.blanks.every(t=>k[t.id]);return e.jsxs("div",{ref:ne,className:"flex w-full gap-4 items-start -mx-4",style:{touchAction:"none"},children:[e.jsx("style",{children:`
        .touch-drop-zone.touch-hover {
          background-color: rgb(219 234 254) !important;
          border-color: rgb(59 130 246) !important;
          transform: scale(1.05);
        }
        
        .touch-drop-zone.touch-hover-operator {
          background-color: rgb(254 215 170) !important;
          border-color: rgb(251 146 60) !important;
          transform: scale(1.05);
        }
        
        .touch-drop-zone.drop-success {
          background-color: rgb(187 247 208) !important;
          border-color: rgb(34 197 94) !important;
          animation: pulse 0.3s ease-in-out;
        }
        
        @keyframes pulse {
          0%, 100% { transform: scale(1); }
          50% { transform: scale(1.1); }
        }
        
        .drag-item-touch {
          user-select: none;
          -webkit-user-select: none;
          -webkit-touch-callout: none;
          -webkit-tap-highlight-color: transparent;
        }
      `}),e.jsx("aside",{className:"w-[220px] shrink-0 pl-4",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4",children:e.jsx(_e,{seconds:V,hasStarted:G})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-4",children:e.jsxs("div",{className:"space-y-4 text-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Задача"}),e.jsxs("span",{className:"font-semibold",children:[$+1,"/",u.length]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Верни"}),e.jsx("span",{className:"font-semibold",children:_})]}),c&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Играч"}),e.jsx("span",{className:"font-semibold",children:((he=c.players[A])==null?void 0:he.name)||"Играч"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-3 space-y-2",children:[Ie&&z===null&&e.jsxs(se,{onClick:ye,className:"w-full flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Провери"]}),e.jsx(se,{variant:"outline",onClick:ke,className:"w-full",children:"🧠 Реши"}),e.jsxs(se,{variant:"outline",onClick:ge,className:"w-full",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Започни отначало"]}),!c&&e.jsxs(se,{variant:"outline",onClick:async()=>{if(F(),fe.isSinglePlayerMode(c))try{await fe.submitMathGameStats({correctAnswers:_,totalProblems:u.length,timeElapsed:V}),console.log("Stats submitted via Complete Game button")}catch(t){console.error("Failed to submit stats:",t)}T(!0)},className:"w-full bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Завърши играта"]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 w-full mb-6",children:[e.jsx("div",{className:"text-3xl font-bold text-center mb-8 leading-relaxed flex items-center justify-center",children:R.mode==="grid"&&R.grid?Ne(R.grid,R.blanks):je(R.equation||"",R.blanks)}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2 text-center font-medium",children:"Числа:"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:P.filter(t=>!isNaN(Number(t.value))).map(t=>e.jsx("div",{draggable:!t.isUsed,onDragStart:s=>q(s,t.id),onTouchStart:s=>ie(s,t.id),onTouchMove:ce,onTouchEnd:de,className:`px-6 py-4 text-2xl font-semibold rounded-lg border-2 transition-all select-none drag-item-touch ${t.isUsed?"bg-gray-200 border-gray-300 text-gray-500 cursor-not-allowed opacity-50":N.draggedItemId===t.id?"bg-blue-200 border-blue-400 shadow-xl":"bg-white border-gray-300 cursor-move active:scale-105"}`,style:{minHeight:"4rem",minWidth:"4rem",touchAction:"none"},children:t.value},t.id))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-2 text-center font-medium",children:"Операции:"}),e.jsx("div",{className:"flex flex-wrap justify-center gap-4",children:P.filter(t=>isNaN(Number(t.value))).map(t=>e.jsx("div",{draggable:!t.isUsed,onDragStart:s=>q(s,t.id),onTouchStart:s=>ie(s,t.id),onTouchMove:ce,onTouchEnd:de,className:`px-6 py-4 text-2xl font-semibold rounded-lg border-2 transition-all select-none drag-item-touch ${t.isUsed?"bg-gray-200 border-gray-300 text-gray-500 cursor-not-allowed opacity-50":N.draggedItemId===t.id?"bg-orange-200 border-orange-400 shadow-xl":"bg-orange-50 border-orange-300 cursor-move active:scale-105"}`,style:{minHeight:"4rem",minWidth:"4rem",touchAction:"none"},children:t.value},t.id))})]}),z&&e.jsx("div",{className:`mt-6 p-4 rounded-md text-white text-center ${z==="correct"?"bg-green-500":"bg-red-500"}`,children:z==="correct"?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(le,{className:"w-6 h-6 mr-2"}),"Правилно!"]}):e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(Me,{className:"w-6 h-6 mr-2"}),R.mode==="grid"?"Грешно! Попълнете правилно всички клетки.":`Грешно! Правилният отговор е ${R.correctAnswer}.`]})})]})})]})};export{Le as M};
