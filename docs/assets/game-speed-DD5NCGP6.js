import{j as e}from"./ui-vendor-D57amxQA.js";import{r,u as X}from"./react-vendor-oV3x6oea.js";import{T as Y,B as T,H as z,g as L,c as B,C as q}from"./game-memory-Boi4oVcu.js";const J=1,Z=1e6;let I=0;function ee(){return I=(I+1)%Number.MAX_SAFE_INTEGER,I.toString()}const O=new Map,V=s=>{if(O.has(s))return;const t=setTimeout(()=>{O.delete(s),A({type:"REMOVE_TOAST",toastId:s})},Z);O.set(s,t)},se=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,J)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?V(a):s.toasts.forEach(l=>{V(l.id)}),{...s,toasts:s.toasts.map(l=>l.id===a||a===void 0?{...l,open:!1}:l)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},k=[];let $={toasts:[]};function A(s){$=se($,s),k.forEach(t=>{t($)})}function te({...s}){const t=ee(),a=i=>A({type:"UPDATE_TOAST",toast:{...i,id:t}}),l=()=>A({type:"DISMISS_TOAST",toastId:t});return A({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:i=>{i||l()}}}),{id:t,dismiss:l,update:a}}function ae(){const[s,t]=r.useState($);return r.useEffect(()=>(k.push(t),()=>{const a=k.indexOf(t);a>-1&&k.splice(a,1)}),[s]),{...s,toast:te,dismiss:a=>A({type:"DISMISS_TOAST",toastId:a})}}const y=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),U=()=>window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),le=()=>y()&&U(),xe=()=>y()&&U()&&window.matchMedia("(orientation: landscape)").matches,me=()=>le()?window.innerHeight-(window.screen.height-window.innerHeight):window.innerHeight,_=768;function K(){const[s,t]=r.useState(void 0);return r.useEffect(()=>{const a=window.matchMedia(`(max-width: ${_-1}px)`),l=()=>{t(window.innerWidth<_)};return a.addEventListener("change",l),t(window.innerWidth<_),()=>a.removeEventListener("change",l)},[]),!!s}const F=({speed:s,onCorrect:t,onIncorrect:a,gameActive:l,difficulty:i})=>{const[m,o]=r.useState("green"),[v,g]=r.useState(["green","blue"]),n=r.useRef(null),d=K(),w={green:"#22c55e",blue:"#3b82f6",red:"#ef4444"},b={green:"Зелено",blue:"Синьо",red:"Червено"},S=()=>i==="hard"?["green","blue","red"]:["green","blue"],x=r.useCallback(()=>{const c=S(),u=c[Math.floor(Math.random()*c.length)],N=[...c].sort(()=>Math.random()-.5);o(u),g(N)},[i]),j=r.useCallback(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{l&&(x(),j())},s)},[s,l,x]);r.useEffect(()=>(l?(x(),j()):n.current&&(clearTimeout(n.current),n.current=null),()=>{n.current&&(clearTimeout(n.current),n.current=null)}),[l,s,x,j]);const p=r.useCallback(c=>{l&&(n.current&&(clearTimeout(n.current),n.current=null),c===m?t():a(),x(),j())},[l,m,t,a,x,j]),C=i==="hard"?"grid-cols-3":"grid-cols-2";return e.jsxs("div",{className:`flex flex-col items-center w-full ${d?"max-w-sm":"max-w-2xl"}`,children:[e.jsx("div",{className:`w-full bg-white rounded-2xl shadow-lg flex items-center justify-center ${d?"p-4 mb-4":"p-8 mb-8"}`,children:e.jsx("div",{className:`rounded-2xl flex items-center justify-center text-white font-bold transition-all ${d?"w-32 h-32 text-lg":"w-40 h-40 text-2xl"}`,style:{backgroundColor:w[m],boxShadow:`0 10px 15px -3px ${w[m]}40`},children:b[m]})}),e.jsx("div",{className:`grid ${C} w-full ${d?"gap-4":"gap-8"}`,children:v.map((c,u)=>e.jsx("button",{onClick:()=>p(c),className:`aspect-square rounded-3xl shadow-lg transform transition-all hover:scale-105 active:scale-95 focus:outline-none ${d?"touch-manipulation":""}`,style:{backgroundColor:w[c],boxShadow:`0 10px 15px -3px ${w[c]}40`},disabled:!l},u))})]})},re=({correctAnswers:s,wrongAnswers:t,totalAttempts:a,timeSpent:l,onPlayAgain:i})=>{const m=X(),o=g=>{const n=Math.floor(g/60),d=g%60;return`${n}:${d.toString().padStart(2,"0")}`},v=localStorage.getItem("currentPlayerName")||"Играч";return e.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(Y,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:["Браво, ",v,"!"]}),e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Завърши скоростната игра!"}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Време:"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:o(l)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Общо опити:"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:a})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600",children:"Верни:"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:s})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-red-600",children:"Грешни:"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:t})]})]})]})]}),e.jsxs(T,{onClick:()=>{y()?i():m("/")},variant:"outline",className:"w-full",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),y()?"Играй отново":"Към началото"]})]})})},ne=({seconds:s,hasStarted:t,label:a="",className:l=""})=>{const i=Math.floor(s/60).toString().padStart(2,"0"),m=(s%60).toString().padStart(2,"0");return e.jsxs("div",{className:`flex flex-col items-center ${l}`,"data-testid":"compact-chronometer",children:[a&&e.jsx("div",{className:"text-xs text-gray-600 mb-1 text-center whitespace-nowrap",children:a}),e.jsxs("div",{className:"relative w-16 h-16 flex-shrink-0",children:[e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-2 border-slate-300 shadow-lg"}),e.jsx("div",{className:"absolute inset-1 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-sm font-bold tabular-nums tracking-tight text-gray-800",children:t?`${i}:${m}`:"00:00"})}),e.jsx("div",{className:"absolute top-1 left-1/2 -translate-x-1/2 w-0.5 h-2 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 w-0.5 h-2 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-1 w-2 h-0.5 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-1 w-2 h-0.5 bg-slate-400 rounded"})]})]})},ie=({label:s="",seconds:t,hasStarted:a})=>{const l=Math.floor(t/60).toString().padStart(2,"0"),i=(t%60).toString().padStart(2,"0");return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-2",children:s}),e.jsxs("div",{className:"relative mx-auto w-36 h-36",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-12 h-6 bg-gray-300 rounded-t-xl shadow"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-4 border-slate-300 shadow-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold tabular-nums tracking-wider",children:a?`${l}:${i}`:"00:00"})}),e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-3 w-3 h-1 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-3 w-3 h-1 bg-slate-400 rounded"})]})]})},ue=({level:s,onComplete:t,onTimeUp:a,onBackToSelection:l,onGameStateChange:i,isLandscapeMode:m=!1})=>{const[o,v]=r.useState(null),[g,n]=r.useState(!1),[d,w]=r.useState(!1),[b,S]=r.useState(0),[x,j]=r.useState(0),[p,M]=r.useState(0),[C,c]=r.useState(0),u=r.useRef(null),{toast:N}=ae(),h=K(),P=y(),R=o==="slow"?2e3:1e3,D=r.useCallback(()=>{n(!0),S(0),j(0),M(0),c(0),u.current=setInterval(()=>{S(f=>f+1)},1e3)},[]),W=r.useCallback(async()=>{if(u.current&&clearInterval(u.current),w(!0),L.isSinglePlayerMode()&&!y())try{await L.submitSpeedGameStats({correctAnswers:x,wrongAnswers:p,timeElapsed:b}),console.log("Stats submitted via Complete Game button")}catch(f){console.error("Failed to submit stats:",f)}t()},[t,x,p,b]),G=r.useCallback(()=>{j(f=>f+1),c(f=>f+1),N({title:"Правилен отговор!",description:"Браво!",duration:1e3})},[N]),H=r.useCallback(()=>{M(f=>f+1),c(f=>f+1),N({title:"Грешен отговор!",description:"Опитай отново!",variant:"destructive",duration:1e3})},[N]),Q=r.useCallback(()=>{w(!1),n(!1)},[]),E=r.useCallback(()=>{if(u.current&&clearInterval(u.current),P&&l){l();return}v(null),n(!1),w(!1),S(0),j(0),M(0),c(0)},[P,l]);return r.useCallback(()=>{E()},[E]),r.useEffect(()=>()=>{u.current&&clearInterval(u.current)},[]),r.useEffect(()=>{o&&!g&&!d&&D()},[o,g,d,D]),r.useEffect(()=>{i&&i(!o)},[o,i]),d?e.jsx(re,{correctAnswers:x,wrongAnswers:p,totalAttempts:C,timeSpent:b,onPlayAgain:Q}):o?h?e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-green-600",children:x}),e.jsx("div",{className:"text-xs text-gray-500",children:"Верни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-red-600",children:p}),e.jsx("div",{className:"text-xs text-gray-500",children:"Грешни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:C}),e.jsx("div",{className:"text-xs text-gray-500",children:"Общо"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-lg",children:[Math.floor(b/60).toString().padStart(2,"0"),":",(b%60).toString().padStart(2,"0")]}),e.jsx("div",{className:"text-xs text-gray-500",children:o==="slow"?"Бавно":"Бързо"})]})]})}),e.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-md p-4",children:e.jsx("div",{className:"flex justify-center h-full",children:e.jsx(F,{speed:R,onCorrect:G,onIncorrect:H,gameActive:!d,difficulty:o==="slow"?"easy":"hard"})})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mt-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(T,{variant:"outline",onClick:E,className:"flex-1",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Отначало"]}),e.jsxs(T,{variant:"outline",onClick:W,className:"flex-1 bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Завърши"]})]})})]}):e.jsxs("div",{className:"flex w-full gap-4 items-start -mx-4",children:[e.jsx("aside",{className:"w-[220px] shrink-0 pl-4",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4",children:m?e.jsx(ne,{seconds:b,hasStarted:g}):e.jsx(ie,{seconds:b,hasStarted:g})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-4",children:e.jsxs("div",{className:"space-y-4 text-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Верни"}),e.jsx("span",{className:"font-semibold",children:x})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Грешни"}),e.jsx("span",{className:"font-semibold",children:p})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Общо"}),e.jsx("span",{className:"font-semibold",children:C})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Скорост"}),e.jsx("span",{className:"font-semibold",children:o==="slow"?"Бавно":"Бързо"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-3 space-y-2",children:[e.jsxs(T,{variant:"outline",onClick:E,className:"w-full",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Започни отначало"]}),e.jsxs(T,{variant:"outline",onClick:W,className:"w-full bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Завърши играта"]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 w-full",children:[e.jsx("div",{className:"text-center mb-6"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{speed:R,onCorrect:G,onIncorrect:H,gameActive:!d,difficulty:o==="slow"?"easy":"hard"})})]})})]}):e.jsx("div",{className:`flex flex-col items-center justify-center w-full ${h?"py-4 px-4":"max-w-4xl mx-auto py-12"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl text-center w-full ${h?"p-4":"p-8 max-w-2xl"}`,children:[e.jsx("h2",{className:`font-bold text-gray-800 mb-6 ${h?"text-xl":"text-3xl"}`,children:"Изберете скорост"}),e.jsxs("div",{className:`grid gap-6 ${h?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>v("slow"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${h?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${h?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#10B98120"},children:"🐌"}),e.jsx("span",{className:`font-semibold text-gray-800 ${h?"text-lg":"text-xl"}`,children:"Бавно"})]}),e.jsxs("button",{onClick:()=>v("fast"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${h?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${h?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#EF444420"},children:"🚀"}),e.jsx("span",{className:`font-semibold text-gray-800 ${h?"text-lg":"text-xl"}`,children:"Бързо"})]})]})]})})};export{ue as S,y as a,me as g,xe as i,ae as u};
