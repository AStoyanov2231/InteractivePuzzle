import{j as e}from"./ui-vendor-D57amxQA.js";import{r as l,u as K}from"./react-vendor-oV3x6oea.js";import{T as Q,B as S,H as X,g as L,c as q,C as H}from"./game-memory-Boi4oVcu.js";const Y=1,z=1e6;let $=0;function J(){return $=($+1)%Number.MAX_SAFE_INTEGER,$.toString()}const I=new Map,B=s=>{if(I.has(s))return;const t=setTimeout(()=>{I.delete(s),C({type:"REMOVE_TOAST",toastId:s})},z);I.set(s,t)},Z=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,Y)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?B(a):s.toasts.forEach(r=>{B(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(a=>a.id!==t.toastId)}}},A=[];let M={toasts:[]};function C(s){M=Z(M,s),A.forEach(t=>{t(M)})}function ee({...s}){const t=J(),a=o=>C({type:"UPDATE_TOAST",toast:{...o,id:t}}),r=()=>C({type:"DISMISS_TOAST",toastId:t});return C({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:o=>{o||r()}}}),{id:t,dismiss:r,update:a}}function se(){const[s,t]=l.useState(M);return l.useEffect(()=>(A.push(t),()=>{const a=A.indexOf(t);a>-1&&A.splice(a,1)}),[s]),{...s,toast:ee,dismiss:a=>C({type:"DISMISS_TOAST",toastId:a})}}const k=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),O=768;function U(){const[s,t]=l.useState(void 0);return l.useEffect(()=>{const a=window.matchMedia(`(max-width: ${O-1}px)`),r=()=>{t(window.innerWidth<O)};return a.addEventListener("change",r),t(window.innerWidth<O),()=>a.removeEventListener("change",r)},[]),!!s}const F=({speed:s,onCorrect:t,onIncorrect:a,gameActive:r,difficulty:o})=>{const[c,j]=l.useState("green"),[v,g]=l.useState(["green","blue"]),n=l.useRef(null),x=U(),m={green:"#22c55e",blue:"#3b82f6",red:"#ef4444"},w={green:"Зелено",blue:"Синьо",red:"Червено"},N=()=>o==="hard"?["green","blue","red"]:["green","blue"],f=l.useCallback(()=>{const i=N(),b=i[Math.floor(Math.random()*i.length)],d=[...i].sort(()=>Math.random()-.5);j(b),g(d)},[o]),u=l.useCallback(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r&&(f(),u())},s)},[s,r,f]);l.useEffect(()=>(r?(f(),u()):n.current&&(clearTimeout(n.current),n.current=null),()=>{n.current&&(clearTimeout(n.current),n.current=null)}),[r,s,f,u]);const y=l.useCallback(i=>{r&&(n.current&&(clearTimeout(n.current),n.current=null),i===c?t():a(),f(),u())},[r,c,t,a,f,u]),p=o==="hard"?"grid-cols-3":"grid-cols-2";return e.jsxs("div",{className:`flex flex-col items-center w-full ${x?"max-w-sm":"max-w-2xl"}`,children:[e.jsx("div",{className:`w-full bg-white rounded-2xl shadow-lg flex items-center justify-center ${x?"p-4 mb-4":"p-8 mb-8"}`,children:e.jsx("div",{className:`rounded-2xl flex items-center justify-center text-white font-bold transition-all ${x?"w-32 h-32 text-lg":"w-40 h-40 text-2xl"}`,style:{backgroundColor:m[c],boxShadow:`0 10px 15px -3px ${m[c]}40`},children:w[c]})}),e.jsx("div",{className:`grid ${p} w-full ${x?"gap-4":"gap-8"}`,children:v.map((i,b)=>e.jsx("button",{onClick:()=>y(i),className:`aspect-square rounded-3xl shadow-lg transform transition-all hover:scale-105 active:scale-95 focus:outline-none ${x?"touch-manipulation":""}`,style:{backgroundColor:m[i],boxShadow:`0 10px 15px -3px ${m[i]}40`},disabled:!r},b))})]})},te=({correctAnswers:s,wrongAnswers:t,totalAttempts:a,timeSpent:r,onPlayAgain:o})=>{const c=K(),j=g=>{const n=Math.floor(g/60),x=g%60;return`${n}:${x.toString().padStart(2,"0")}`},v=localStorage.getItem("currentPlayerName")||"Играч";return e.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(Q,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:["Браво, ",v,"!"]}),e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Завърши скоростната игра!"}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Време:"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:j(r)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Общо опити:"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:a})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600",children:"Верни:"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:s})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-red-600",children:"Грешни:"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:t})]})]})]})]}),e.jsxs(S,{onClick:()=>{k()?o():c("/")},variant:"outline",className:"w-full",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),k()?"Играй отново":"Към началото"]})]})})},le=({label:s="",seconds:t,hasStarted:a})=>{const r=Math.floor(t/60).toString().padStart(2,"0"),o=(t%60).toString().padStart(2,"0");return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-2",children:s}),e.jsxs("div",{className:"relative mx-auto w-36 h-36",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-12 h-6 bg-gray-300 rounded-t-xl shadow"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-4 border-slate-300 shadow-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold tabular-nums tracking-wider",children:a?`${r}:${o}`:"00:00"})}),e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-3 w-3 h-1 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-3 w-3 h-1 bg-slate-400 rounded"})]})]})},ce=({level:s,onComplete:t,onTimeUp:a,onBackToSelection:r,onGameStateChange:o})=>{const[c,j]=l.useState(null),[v,g]=l.useState(!1),[n,x]=l.useState(!1),[m,w]=l.useState(0),[N,f]=l.useState(0),[u,y]=l.useState(0),[T,p]=l.useState(0),i=l.useRef(null),{toast:b}=se(),d=U(),_=k(),R=c==="slow"?2e3:1e3,D=l.useCallback(()=>{g(!0),w(0),f(0),y(0),p(0),i.current=setInterval(()=>{w(h=>h+1)},1e3)},[]),P=l.useCallback(async()=>{if(i.current&&clearInterval(i.current),x(!0),L.isSinglePlayerMode()&&!k())try{await L.submitSpeedGameStats({correctAnswers:N,wrongAnswers:u,timeElapsed:m}),console.log("Stats submitted via Complete Game button")}catch(h){console.error("Failed to submit stats:",h)}t()},[t,N,u,m]),G=l.useCallback(()=>{f(h=>h+1),p(h=>h+1),b({title:"Правилен отговор!",description:"Браво!",duration:1e3})},[b]),W=l.useCallback(()=>{y(h=>h+1),p(h=>h+1),b({title:"Грешен отговор!",description:"Опитай отново!",variant:"destructive",duration:1e3})},[b]),V=l.useCallback(()=>{x(!1),g(!1)},[]),E=l.useCallback(()=>{if(i.current&&clearInterval(i.current),_&&r){r();return}j(null),g(!1),x(!1),w(0),f(0),y(0),p(0)},[_,r]);return l.useCallback(()=>{E()},[E]),l.useEffect(()=>()=>{i.current&&clearInterval(i.current)},[]),l.useEffect(()=>{c&&!v&&!n&&D()},[c,v,n,D]),l.useEffect(()=>{o&&o(!c)},[c,o]),n?e.jsx(te,{correctAnswers:N,wrongAnswers:u,totalAttempts:T,timeSpent:m,onPlayAgain:V}):c?d?e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-green-600",children:N}),e.jsx("div",{className:"text-xs text-gray-500",children:"Верни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-red-600",children:u}),e.jsx("div",{className:"text-xs text-gray-500",children:"Грешни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:T}),e.jsx("div",{className:"text-xs text-gray-500",children:"Общо"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-lg",children:[Math.floor(m/60).toString().padStart(2,"0"),":",(m%60).toString().padStart(2,"0")]}),e.jsx("div",{className:"text-xs text-gray-500",children:c==="slow"?"Бавно":"Бързо"})]})]})}),e.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-md p-4",children:e.jsx("div",{className:"flex justify-center h-full",children:e.jsx(F,{speed:R,onCorrect:G,onIncorrect:W,gameActive:!n,difficulty:c==="slow"?"easy":"hard"})})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mt-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",onClick:E,className:"flex-1",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Отначало"]}),e.jsxs(S,{variant:"outline",onClick:P,className:"flex-1 bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Завърши"]})]})})]}):e.jsxs("div",{className:"flex w-full gap-4 items-start -mx-4",children:[e.jsx("aside",{className:"w-[220px] shrink-0 pl-4",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4",children:e.jsx(le,{seconds:m,hasStarted:v})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-4",children:e.jsxs("div",{className:"space-y-4 text-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Верни"}),e.jsx("span",{className:"font-semibold",children:N})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Грешни"}),e.jsx("span",{className:"font-semibold",children:u})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Общо"}),e.jsx("span",{className:"font-semibold",children:T})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Скорост"}),e.jsx("span",{className:"font-semibold",children:c==="slow"?"Бавно":"Бързо"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-3 space-y-2",children:[e.jsxs(S,{variant:"outline",onClick:E,className:"w-full",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Започни отначало"]}),e.jsxs(S,{variant:"outline",onClick:P,className:"w-full bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Завърши играта"]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 w-full",children:[e.jsx("div",{className:"text-center mb-6"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(F,{speed:R,onCorrect:G,onIncorrect:W,gameActive:!n,difficulty:c==="slow"?"easy":"hard"})})]})})]}):e.jsx("div",{className:`flex flex-col items-center justify-center w-full ${d?"py-4 px-4":"max-w-4xl mx-auto py-12"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl text-center w-full ${d?"p-4":"p-8 max-w-2xl"}`,children:[e.jsx("h2",{className:`font-bold text-gray-800 mb-6 ${d?"text-xl":"text-3xl"}`,children:"Изберете скорост"}),e.jsxs("div",{className:`grid gap-6 ${d?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>j("slow"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${d?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${d?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#10B98120"},children:"🐌"}),e.jsx("span",{className:`font-semibold text-gray-800 ${d?"text-lg":"text-xl"}`,children:"Бавно"})]}),e.jsxs("button",{onClick:()=>j("fast"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${d?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${d?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#EF444420"},children:"🚀"}),e.jsx("span",{className:`font-semibold text-gray-800 ${d?"text-lg":"text-xl"}`,children:"Бързо"})]})]})]})})};export{ce as S,k as i,se as u};
