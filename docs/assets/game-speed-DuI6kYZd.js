import{j as e}from"./ui-vendor-D57amxQA.js";import{r as a,u as Q}from"./react-vendor-oV3x6oea.js";import{T as X,B as S,H as Y,g as G,c as L,C as B}from"./game-memory-Boi4oVcu.js";const z=1,J=1e6;let $=0;function Z(){return $=($+1)%Number.MAX_SAFE_INTEGER,$.toString()}const I=new Map,q=s=>{if(I.has(s))return;const t=setTimeout(()=>{I.delete(s),C({type:"REMOVE_TOAST",toastId:s})},J);I.set(s,t)},ee=(s,t)=>{switch(t.type){case"ADD_TOAST":return{...s,toasts:[t.toast,...s.toasts].slice(0,z)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(l=>l.id===t.toast.id?{...l,...t.toast}:l)};case"DISMISS_TOAST":{const{toastId:l}=t;return l?q(l):s.toasts.forEach(r=>{q(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===l||l===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(l=>l.id!==t.toastId)}}},M=[];let k={toasts:[]};function C(s){k=ee(k,s),M.forEach(t=>{t(k)})}function se({...s}){const t=Z(),l=c=>C({type:"UPDATE_TOAST",toast:{...c,id:t}}),r=()=>C({type:"DISMISS_TOAST",toastId:t});return C({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:c=>{c||r()}}}),{id:t,dismiss:r,update:l}}function te(){const[s,t]=a.useState(k);return a.useEffect(()=>(M.push(t),()=>{const l=M.indexOf(t);l>-1&&M.splice(l,1)}),[s]),{...s,toast:se,dismiss:l=>C({type:"DISMISS_TOAST",toastId:l})}}const T=()=>window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0||document.referrer.includes("android-app://"),ae=()=>window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),F=()=>T()&&ae(),ce=()=>F()&&window.matchMedia("(orientation: landscape)").matches&&window.innerHeight<=500,de=()=>F()?window.innerHeight-(window.screen.height-window.innerHeight):window.innerHeight,O=768;function U(){const[s,t]=a.useState(void 0);return a.useEffect(()=>{const l=window.matchMedia(`(max-width: ${O-1}px)`),r=()=>{t(window.innerWidth<O)};return l.addEventListener("change",r),t(window.innerWidth<O),()=>l.removeEventListener("change",r)},[]),!!s}const V=({speed:s,onCorrect:t,onIncorrect:l,gameActive:r,difficulty:c})=>{const[i,j]=a.useState("green"),[w,g]=a.useState(["green","blue"]),n=a.useRef(null),x=U(),m={green:"#22c55e",blue:"#3b82f6",red:"#ef4444"},N={green:"Зелено",blue:"Синьо",red:"Червено"},v=()=>c==="hard"?["green","blue","red"]:["green","blue"],f=a.useCallback(()=>{const o=v(),b=o[Math.floor(Math.random()*o.length)],d=[...o].sort(()=>Math.random()-.5);j(b),g(d)},[c]),u=a.useCallback(()=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r&&(f(),u())},s)},[s,r,f]);a.useEffect(()=>(r?(f(),u()):n.current&&(clearTimeout(n.current),n.current=null),()=>{n.current&&(clearTimeout(n.current),n.current=null)}),[r,s,f,u]);const y=a.useCallback(o=>{r&&(n.current&&(clearTimeout(n.current),n.current=null),o===i?t():l(),f(),u())},[r,i,t,l,f,u]),p=c==="hard"?"grid-cols-3":"grid-cols-2";return e.jsxs("div",{className:`flex flex-col items-center w-full ${x?"max-w-sm":"max-w-2xl"}`,children:[e.jsx("div",{className:`w-full bg-white rounded-2xl shadow-lg flex items-center justify-center ${x?"p-4 mb-4":"p-8 mb-8"}`,children:e.jsx("div",{className:`rounded-2xl flex items-center justify-center text-white font-bold transition-all ${x?"w-32 h-32 text-lg":"w-40 h-40 text-2xl"}`,style:{backgroundColor:m[i],boxShadow:`0 10px 15px -3px ${m[i]}40`},children:N[i]})}),e.jsx("div",{className:`grid ${p} w-full ${x?"gap-4":"gap-8"}`,children:w.map((o,b)=>e.jsx("button",{onClick:()=>y(o),className:`aspect-square rounded-3xl shadow-lg transform transition-all hover:scale-105 active:scale-95 focus:outline-none ${x?"touch-manipulation":""}`,style:{backgroundColor:m[o],boxShadow:`0 10px 15px -3px ${m[o]}40`},disabled:!r},b))})]})},le=({correctAnswers:s,wrongAnswers:t,totalAttempts:l,timeSpent:r,onPlayAgain:c})=>{const i=Q(),j=g=>{const n=Math.floor(g/60),x=g%60;return`${n}:${x.toString().padStart(2,"0")}`},w=localStorage.getItem("currentPlayerName")||"Играч";return e.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-12",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(X,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:["Браво, ",w,"!"]}),e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Завърши скоростната игра!"}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Време:"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:j(r)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Общо опити:"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:l})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-600",children:"Верни:"}),e.jsx("div",{className:"text-lg font-bold text-green-600",children:s})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-red-600",children:"Грешни:"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:t})]})]})]})]}),e.jsxs(S,{onClick:()=>{T()?c():i("/")},variant:"outline",className:"w-full",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),T()?"Играй отново":"Към началото"]})]})})},re=({label:s="",seconds:t,hasStarted:l})=>{const r=Math.floor(t/60).toString().padStart(2,"0"),c=(t%60).toString().padStart(2,"0");return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-2",children:s}),e.jsxs("div",{className:"relative mx-auto w-36 h-36",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-12 h-6 bg-gray-300 rounded-t-xl shadow"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-4 border-slate-300 shadow-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold tabular-nums tracking-wider",children:l?`${r}:${c}`:"00:00"})}),e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-3 w-3 h-1 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-3 w-3 h-1 bg-slate-400 rounded"})]})]})},xe=({level:s,onComplete:t,onTimeUp:l,onBackToSelection:r,onGameStateChange:c})=>{const[i,j]=a.useState(null),[w,g]=a.useState(!1),[n,x]=a.useState(!1),[m,N]=a.useState(0),[v,f]=a.useState(0),[u,y]=a.useState(0),[A,p]=a.useState(0),o=a.useRef(null),{toast:b}=te(),d=U(),_=T(),P=i==="slow"?2e3:1e3,R=a.useCallback(()=>{g(!0),N(0),f(0),y(0),p(0),o.current=setInterval(()=>{N(h=>h+1)},1e3)},[]),D=a.useCallback(async()=>{if(o.current&&clearInterval(o.current),x(!0),G.isSinglePlayerMode()&&!T())try{await G.submitSpeedGameStats({correctAnswers:v,wrongAnswers:u,timeElapsed:m}),console.log("Stats submitted via Complete Game button")}catch(h){console.error("Failed to submit stats:",h)}t()},[t,v,u,m]),H=a.useCallback(()=>{f(h=>h+1),p(h=>h+1),b({title:"Правилен отговор!",description:"Браво!",duration:1e3})},[b]),W=a.useCallback(()=>{y(h=>h+1),p(h=>h+1),b({title:"Грешен отговор!",description:"Опитай отново!",variant:"destructive",duration:1e3})},[b]),K=a.useCallback(()=>{x(!1),g(!1)},[]),E=a.useCallback(()=>{if(o.current&&clearInterval(o.current),_&&r){r();return}j(null),g(!1),x(!1),N(0),f(0),y(0),p(0)},[_,r]);return a.useCallback(()=>{E()},[E]),a.useEffect(()=>()=>{o.current&&clearInterval(o.current)},[]),a.useEffect(()=>{i&&!w&&!n&&R()},[i,w,n,R]),a.useEffect(()=>{c&&c(!i)},[i,c]),n?e.jsx(le,{correctAnswers:v,wrongAnswers:u,totalAttempts:A,timeSpent:m,onPlayAgain:K}):i?d?e.jsxs("div",{className:"flex flex-col w-full h-full",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-green-600",children:v}),e.jsx("div",{className:"text-xs text-gray-500",children:"Верни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold text-red-600",children:u}),e.jsx("div",{className:"text-xs text-gray-500",children:"Грешни"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-semibold",children:A}),e.jsx("div",{className:"text-xs text-gray-500",children:"Общо"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-semibold text-lg",children:[Math.floor(m/60).toString().padStart(2,"0"),":",(m%60).toString().padStart(2,"0")]}),e.jsx("div",{className:"text-xs text-gray-500",children:i==="slow"?"Бавно":"Бързо"})]})]})}),e.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-md p-4",children:e.jsx("div",{className:"flex justify-center h-full",children:e.jsx(V,{speed:P,onCorrect:H,onIncorrect:W,gameActive:!n,difficulty:i==="slow"?"easy":"hard"})})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-3 mt-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",onClick:E,className:"flex-1",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Отначало"]}),e.jsxs(S,{variant:"outline",onClick:D,className:"flex-1 bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Завърши"]})]})})]}):e.jsxs("div",{className:"flex w-full gap-4 items-start -mx-4",children:[e.jsx("aside",{className:"w-[220px] shrink-0 pl-4",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4",children:e.jsx(re,{seconds:m,hasStarted:w})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-4",children:e.jsxs("div",{className:"space-y-4 text-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Верни"}),e.jsx("span",{className:"font-semibold",children:v})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Грешни"}),e.jsx("span",{className:"font-semibold",children:u})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Общо"}),e.jsx("span",{className:"font-semibold",children:A})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Скорост"}),e.jsx("span",{className:"font-semibold",children:i==="slow"?"Бавно":"Бързо"})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-3 space-y-2",children:[e.jsxs(S,{variant:"outline",onClick:E,className:"w-full",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Започни отначало"]}),e.jsxs(S,{variant:"outline",onClick:D,className:"w-full bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Завърши играта"]})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col items-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 w-full",children:[e.jsx("div",{className:"text-center mb-6"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(V,{speed:P,onCorrect:H,onIncorrect:W,gameActive:!n,difficulty:i==="slow"?"easy":"hard"})})]})})]}):e.jsx("div",{className:`flex flex-col items-center justify-center w-full ${d?"py-4 px-4":"max-w-4xl mx-auto py-12"}`,children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl text-center w-full ${d?"p-4":"p-8 max-w-2xl"}`,children:[e.jsx("h2",{className:`font-bold text-gray-800 mb-6 ${d?"text-xl":"text-3xl"}`,children:"Изберете скорост"}),e.jsxs("div",{className:`grid gap-6 ${d?"grid-cols-1":"grid-cols-1 md:grid-cols-2"}`,children:[e.jsxs("button",{onClick:()=>j("slow"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${d?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${d?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#10B98120"},children:"🐌"}),e.jsx("span",{className:`font-semibold text-gray-800 ${d?"text-lg":"text-xl"}`,children:"Бавно"})]}),e.jsxs("button",{onClick:()=>j("fast"),className:`flex flex-col items-center rounded-xl border-2 border-gray-200 hover:border-gray-400 hover:bg-gray-50 transition-all duration-200 transform hover:scale-105 ${d?"p-4":"p-6"}`,children:[e.jsx("div",{className:`mb-4 p-3 rounded-lg ${d?"text-3xl":"text-4xl"}`,style:{backgroundColor:"#EF444420"},children:"🚀"}),e.jsx("span",{className:`font-semibold text-gray-800 ${d?"text-lg":"text-xl"}`,children:"Бързо"})]})]})]})})};export{xe as S,T as a,de as g,ce as i,te as u};
