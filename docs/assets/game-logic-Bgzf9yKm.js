import{j as e}from"./ui-vendor-D57amxQA.js";import{r as b,u as oe,c as le,d as ne}from"./react-vendor-oV3x6oea.js";import{R as ie,B as K,g as H,C as ce,a as de,T as me,H as ue}from"./game-memory-Boi4oVcu.js";const fe=t=>{const r=Math.floor(t/60),s=t%60;return`${r}:${s.toString().padStart(2,"0")}`},Y=b.forwardRef(({level:t,timeLeft:r,gridSize:s,cellSize:i,board:c,onCellPress:n,onRestart:m,onCompleteGame:d,isCompleted:a,completionProgress:f,movesUsed:o,solutionEstimate:g,showCompletionScreen:F=!1},$)=>{const B=s*s;let P=0;for(let N=0;N<s;N++)for(let M=0;M<s;M++)c[N][M]&&P++;const I=(B-P)/B*100;return e.jsxs("div",{className:"flex w-full gap-4 items-start -mx-4",children:[e.jsx("aside",{className:"w-[220px] shrink-0 pl-4",children:e.jsxs("div",{className:"sticky top-6",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-4 mb-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-center text-sm text-gray-600 mb-2"}),e.jsxs("div",{className:"relative mx-auto w-36 h-36",children:[e.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-12 h-6 bg-gray-300 rounded-t-xl shadow"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-b from-slate-50 to-slate-200 border-4 border-slate-300 shadow-xl"}),e.jsx("div",{className:"absolute inset-2 rounded-full bg-white shadow-inner"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold tabular-nums tracking-wider",children:fe(r)})}),e.jsx("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute bottom-3 left-1/2 -translate-x-1/2 w-1 h-3 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-3 w-3 h-1 bg-slate-400 rounded"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 right-3 w-3 h-1 bg-slate-400 rounded"})]})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-md p-6 mb-4",children:e.jsxs("div",{className:"space-y-4 text-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ходове"}),e.jsx("span",{className:"font-semibold",children:o})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ниво"}),e.jsx("span",{className:"font-semibold",children:t.id})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Прогрес"}),e.jsxs("span",{className:"font-semibold",children:[Math.round(I),"%"]})]})]})}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-md p-3 space-y-2",children:[!a&&e.jsxs("button",{onClick:m,className:`w-full flex items-center justify-center gap-2 px-4 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl \r
                         hover:from-red-600 hover:to-red-700 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl`,children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Рестартирай"})]}),!a&&e.jsxs(K,{variant:"outline",onClick:async()=>{if(H.isSinglePlayerMode())try{await H.submitLogicGameStats({movesUsed:o,timeElapsed:r,completed:!1}),console.log("Stats submitted via Complete Game button")}catch(N){console.error("Failed to submit stats:",N)}d()},className:"w-full bg-green-100 hover:bg-green-200 border-green-300 text-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Завърши играта"]}),a&&!F&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-green-50 border border-green-200 text-green-700 rounded-xl shadow-sm",children:[e.jsx(de,{className:"w-5 h-5 text-green-600"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-bold text-sm",children:"Ниво завършено!"})})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden border border-gray-300",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-400 to-blue-600 transition-all duration-100 ease-out rounded-full relative",style:{width:`${f}%`},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})})})]})]})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"relative bg-white rounded-2xl shadow-2xl p-4 lg:p-6",ref:$,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white to-gray-50 rounded-2xl"}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"grid p-4 lg:p-6 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl shadow-inner border border-gray-200 relative",style:{gridTemplateColumns:`repeat(${s}, minmax(0, 1fr))`,padding:"16px"},children:c.map((N,M)=>N.map((L,T)=>e.jsx("button",{onClick:()=>n(M,T),className:`relative border-2 rounded-lg transition-all duration-150 ease-in-out m-1 ${L?"bg-gradient-to-br from-blue-400 to-blue-600 border-blue-600 shadow-md hover:shadow-lg active:scale-[0.98]":"bg-gradient-to-br from-white to-gray-50 border-gray-200 hover:border-gray-300 hover:shadow-sm"}`,style:{width:`${i}px`,height:`${i}px`}},`${M}-${T}`)))})})]})})]})});Y.displayName="LogicGameUI";const he=t=>{let r=t>>>0;return()=>{r+=1831565813;let s=Math.imul(r^r>>>15,1|r);return s^=s+Math.imul(s^s>>>7,61|s),((s^s>>>14)>>>0)/4294967296}},xe=t=>{let r=2166136261;for(let s=0;s<t.length;s++)r^=t.charCodeAt(s),r=Math.imul(r,16777619);return r>>>0},V=(t,r,s)=>t*s+r,ge=(t,r)=>({row:Math.floor(t/r),col:t%r}),_=(t,r,s,i)=>{const c=[{row:t,col:r}];return i==="plus"?[{r:-1,c:0},{r:1,c:0},{r:0,c:-1},{r:0,c:1}].forEach(m=>{const d=t+m.r,a=r+m.c;d>=0&&d<s&&a>=0&&a<s&&c.push({row:d,col:a})}):i==="diag"?[{r:-1,c:-1},{r:-1,c:1},{r:1,c:-1},{r:1,c:1}].forEach(m=>{const d=t+m.r,a=r+m.c;d>=0&&d<s&&a>=0&&a<s&&c.push({row:d,col:a})}):i==="knight"&&[{r:-2,c:-1},{r:-2,c:1},{r:-1,c:-2},{r:-1,c:2},{r:1,c:-2},{r:1,c:2},{r:2,c:-1},{r:2,c:1}].forEach(m=>{const d=t+m.r,a=r+m.c;d>=0&&d<s&&a>=0&&a<s&&c.push({row:d,col:a})}),c},Z=(t,r,s,i)=>{const c=t.length;_(r,s,c,i).forEach(({row:m,col:d})=>{t[m][d]=!t[m][d]})},be=(t,r)=>{const s=t*t,i=Array.from({length:s},()=>new Uint8Array(s));for(let c=0;c<t;c++)for(let n=0;n<t;n++){const m=V(c,n,t);_(c,n,t,r).forEach(({row:a,col:f})=>{const o=V(a,f,t);i[o][m]=1})}return i},X=(t,r)=>{const s=t.length,i=t.map(a=>Uint8Array.from(a)),c=Uint8Array.from(r);let n=0;const m=Array(s).fill(-1);for(let a=0;a<s&&n<s;a++){let f=n;for(let o=n;o<s;o++)if(i[o][a]===1){f=o;break}if(i[f][a]!==0){if(f!==n){const o=i[f];i[f]=i[n],i[n]=o;const g=c[f];c[f]=c[n],c[n]=g}m[n]=a;for(let o=0;o<s;o++)if(o!==n&&i[o][a]===1){for(let g=a;g<s;g++)i[o][g]^=i[n][g];c[o]^=c[n]}n++}}for(let a=n;a<s;a++){let f=!0;for(let o=0;o<s;o++)if(i[a][o]!==0){f=!1;break}if(f&&c[a]===1)return null}const d=new Uint8Array(s);for(let a=n-1;a>=0;a--){const f=m[a];if(f===-1)continue;let o=c[a];for(let g=f+1;g<s;g++)i[a][g]===1&&(o^=d[g]);d[f]=o}return d},J=t=>t.map(r=>r.slice()),ye=({level:t,onComplete:r})=>{const s=oe();le();const i=b.useRef(null),[c,n]=ne(),[m,d]=b.useState(0),[a,f]=b.useState(64),[o,g]=b.useState(!1),[F,$]=b.useState(0),[B,P]=b.useState(0),[W,I]=b.useState(!1),[N]=b.useState(()=>c.get("seed")||`${t.themeId}-${t.difficultyId}-${t.id}-${Date.now()}`),M=N,L=c.get("pattern")||"plus",T=(t.id-1)%10,C=b.useMemo(()=>{const u=t.difficultyId==="easy"?3:t.difficultyId==="medium"?4:5;return Math.min(u+Math.floor(T/3),6)},[t.difficultyId,T]),A=b.useMemo(()=>{const u=xe(M),x=he(u),l=C,j=L,k=be(l,j),w=t.difficultyId==="easy"?{min:3,max:7}:t.difficultyId==="medium"?{min:8,max:14}:{min:12,max:22};let p=null;for(let v=0;v<30;v++){const S=Array.from({length:l},()=>Array(l).fill(!1)),U=w.min+Math.floor(x()*(w.max-w.min+1)),G=Math.max(1,U);for(let y=0;y<G;y++){const E=Math.floor(x()*l),q=Math.floor(x()*l);Z(S,E,q,j)}const h=new Uint8Array(l*l);for(let y=0;y<l*l;y++){const{row:E,col:q}=ge(y,l);h[y]=S[E][q]?1:0}const R=X(k,h);if(!R)continue;const D=R.reduce((y,E)=>y+(E?1:0),0);if(D>=w.min&&D<=w.max){p={board:S,solution:R,k:G};break}(!p||Math.abs(D-(w.min+w.max)/2)<Math.abs(p.solution.reduce((y,E)=>y+(E?1:0),0)-(w.min+w.max)/2))&&(p={board:S,solution:R,k:G})}if(!p){const v=Array.from({length:l},()=>Array(l).fill(!1));Z(v,0,0,j);const S=new Uint8Array(l*l);S[0]=1;const U=X(k,S)||new Uint8Array(l*l);return{initialBoard:v,solution:U,pattern:j}}return{initialBoard:p.board,solution:p.solution,pattern:j}},[M,C,t.difficultyId,L]),[O,z]=b.useState(A.initialBoard),ee=b.useMemo(()=>A.solution.reduce((u,x)=>u+(x?1:0),0),[A.solution]);b.useEffect(()=>{z(J(A.initialBoard)),P(0),g(!1),$(0),d(0)},[A.initialBoard]),b.useEffect(()=>{if(o)return;const u=setInterval(()=>{d(x=>x+1)},1e3);return()=>clearInterval(u)},[o]),b.useEffect(()=>{const u=()=>{if(i.current){const x=window.innerHeight,l=window.innerWidth,j=80,k=100,w=200,p=24,v=x-j-k,S=Math.min(l-k-w-p,1e3),U=Math.floor(S/(C+1)),G=Math.floor(v/(C+1));let h=Math.min(U,G);C<=4?(h=Math.max(h,100),h=Math.min(h,140)):C<=6?(h=Math.max(h,80),h=Math.min(h,110)):C<=8?(h=Math.max(h,60),h=Math.min(h,85)):(h=Math.max(h,45),h=Math.min(h,70)),f(h)}};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[C]);const te=u=>{for(let x=0;x<u.length;x++)for(let l=0;l<u.length;l++)if(u[x][l])return!1;return!0},se=(u,x)=>{if(o)return;const l=J(O);if(Z(l,u,x,A.pattern),z(l),P(j=>j+1),te(l)){if(g(!0),H.isSinglePlayerMode())try{H.submitLogicGameStats({movesUsed:B+1,timeElapsed:m,completed:!0}).then(()=>{console.log("Stats submitted automatically after completing logic game")}).catch(p=>{console.error("Failed to submit stats:",p)})}catch(p){console.error("Failed to submit stats:",p)}const j=Date.now(),k=800,w=()=>{const p=Date.now()-j,v=Math.min(p/k*100,100);$(v),v<100?requestAnimationFrame(w):setTimeout(()=>I(!0),200)};requestAnimationFrame(w),r()}},Q=()=>{z(J(A.initialBoard)),P(0),g(!1),$(0),I(!1)},ae=()=>{I(!0)},re=u=>{const x=Math.floor(u/60),l=u%60;return`${x}:${l.toString().padStart(2,"0")}`};if(W){const u=localStorage.getItem("currentPlayerName")||"Играч";return e.jsx("div",{className:"flex flex-col items-center justify-center w-full max-w-4xl mx-auto py-12","data-testid":"completion-screen",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 text-center max-w-md w-full",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(me,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsxs("h2",{className:"text-3xl font-bold text-green-600 mb-2",children:["Браво, ",u,"!"]}),e.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Завърши логическото ниво!"}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Време:"}),e.jsx("div",{className:"text-xl font-bold text-blue-600",children:re(m)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ходове:"}),e.jsx("div",{className:"text-xl font-bold text-green-600",children:B})]})]})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(K,{onClick:Q,variant:"outline",className:"w-full border-2 border-gray-300 hover:border-gray-400 text-gray-700 font-medium py-3 rounded-xl transition-all duration-200",children:"Започни отново"}),e.jsxs(K,{onClick:()=>s("/"),variant:"outline",className:"w-full border-2 border-blue-300 hover:border-blue-400 text-blue-700 font-medium py-3 rounded-xl transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),"Начало"]})]})]})})}return e.jsx(Y,{ref:i,level:t,timeLeft:m,gridSize:C,cellSize:a,board:O,onCellPress:se,onRestart:Q,onCompleteGame:ae,isCompleted:o,completionProgress:F,movesUsed:B,solutionEstimate:ee,showCompletionScreen:W})};export{ye as L};
